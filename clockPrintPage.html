<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>時計プリント - 時間学習用</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <style>
        body {
            margin: 20px;
        }

        .clock-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .clock-svg {
            max-width: 100%;
            height: auto;
        }

        .settings-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .clock-settings {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .clock-settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .color-preview {
            width: 24px;
            height: 24px;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: inline-block;
            vertical-align: middle;
        }

        .clocks-print-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .clocks-print-area.horizontal {
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
        }

        .clocks-print-area.horizontal .clock-container {
            width: 50%;
        }

        /* 印刷時の設定 */
        @media print {
            .no-print {
                display: none !important;
            }

            .clock-container {
                padding: 5px;
                margin: 0;
                page-break-inside: avoid;
            }

            .clocks-print-area {
                align-items: center;
            }

            .clocks-print-area.horizontal .clock-container {
                width: 50%;
            }

            body {
                margin: 0;
                padding: 0;
            }

            @page {
                size: A4;
                margin: 5mm;
            }
        }

        .time-input {
            width: 65px;
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
        }

        .time-separator {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0 3px;
        }

        .number-label {
            font-family: 'Arial Rounded MT Bold', 'Hiragino Maru Gothic Pro', sans-serif;
            font-weight: bold;
        }

        .btn-remove-clock {
            padding: 2px 8px;
            font-size: 0.8rem;
        }

        .global-settings {
            background: #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- パンくずリスト（印刷時は非表示） -->
    <nav aria-label="breadcrumb" class="mb-2 no-print">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="index.html">ホーム</a></li>
            <li class="breadcrumb-item active">時計プリント</li>
        </ol>
    </nav>
    <!-- 設定パネル（印刷時は非表示） -->
    <div class="settings-panel no-print">
        <h4 class="mb-3">⏰ 時計プリント - 時間学習用</h4>
        
        <!-- グローバル設定 -->
        <div class="global-settings">
            <div class="row align-items-center">
                <div class="col-auto">
                    <label class="form-label mb-0 fw-bold">レイアウト:</label>
                </div>
                <div class="col-auto">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout" id="layoutVertical" value="vertical" checked>
                        <label class="form-check-label" for="layoutVertical">縦並び</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="layout" id="layoutHorizontal" value="horizontal">
                        <label class="form-check-label" for="layoutHorizontal">横2列</label>
                    </div>
                </div>
                <div class="col-auto ms-auto">
                    <button class="btn btn-success" id="addClockBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg me-1" viewBox="0 0 16 16">
                            <path d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                        </svg>
                        時計を追加
                    </button>
                </div>
            </div>
        </div>

        <!-- 個別時計設定（動的に追加） -->
        <div id="clockSettingsContainer"></div>

        <!-- ボタン -->
        <div class="row mt-3">
            <div class="col-12">
                <button class="btn btn-primary btn-lg" id="printBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-printer me-2" viewBox="0 0 16 16">
                        <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                        <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
                    </svg>
                    印刷する
                </button>
                <a href="index.html" class="btn btn-outline-secondary btn-lg ms-2">戻る</a>
            </div>
        </div>
    </div>

    <!-- 時計表示エリア -->
    <div class="clocks-print-area" id="clocksPrintArea"></div>
</div>

<script>
    let clockId = 0;
    const clocks = [];

    // 時計設定のHTMLテンプレート
    function createClockSettingsHTML(id) {
        return `
        <div class="clock-settings" data-clock-id="${id}">
            <div class="clock-settings-header">
                <strong>時計 #${id + 1}</strong>
                <button class="btn btn-outline-danger btn-remove-clock" onclick="removeClock(${id})">削除</button>
            </div>
            <div class="row">
                <div class="col-md-4 col-12 mb-2">
                    <label class="form-label">タイトル</label>
                    <div class="d-flex align-items-center">
                        <input type="text" class="form-control form-control-sm clock-title" data-id="${id}" placeholder="例: 開始時刻">
                        <button class="btn btn-outline-warning btn-sm ms-1 clock-clear-title-btn" data-id="${id}" title="タイトルクリア">×</button>
                    </div>
                </div>
                <div class="col-md-4 col-12 mb-2">
                    <label class="form-label">時刻</label>
                    <div class="d-flex align-items-center">
                        <input type="number" class="form-control time-input clock-hour" data-id="${id}" min="0" max="28" value="10">
                        <span class="time-separator">:</span>
                        <input type="number" class="form-control time-input clock-minute" data-id="${id}" min="0" max="59" value="0">
                        <span class="time-separator">:</span>
                        <input type="number" class="form-control time-input clock-second" data-id="${id}" min="0" max="59" value="0">
                        <button class="btn btn-outline-secondary btn-sm ms-2 clock-now-btn" data-id="${id}" title="現在時刻">今</button>
                        <button class="btn btn-outline-warning btn-sm ms-1 clock-clear-btn" data-id="${id}" title="クリア">×</button>
                    </div>
                </div>
                <div class="col-md-4 col-12 mb-2">
                    <label class="form-label">針の色</label>
                    <div class="d-flex align-items-center gap-2">
                        <input type="color" class="form-control form-control-color form-control-sm clock-hour-color" data-id="${id}" value="#dc3545" title="短針">
                        <input type="color" class="form-control form-control-color form-control-sm clock-minute-color" data-id="${id}" value="#0d6efd" title="長針">
                        <input type="color" class="form-control form-control-color form-control-sm clock-second-color" data-id="${id}" value="#198754" title="秒針">
                        <div class="form-check ms-2">
                            <input class="form-check-input clock-show-second" type="checkbox" data-id="${id}" checked>
                            <label class="form-check-label" style="font-size:0.8rem;">秒</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="d-flex flex-wrap gap-3">
                        <div class="form-check">
                            <input class="form-check-input clock-show-numbers" type="checkbox" data-id="${id}" checked>
                            <label class="form-check-label">数字</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input clock-show-marks" type="checkbox" data-id="${id}" checked>
                            <label class="form-check-label">目盛り</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input clock-show-digital" type="checkbox" data-id="${id}">
                            <label class="form-check-label">デジタル</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input clock-use-24h" type="checkbox" data-id="${id}">
                            <label class="form-check-label">24時間</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        `;
    }

    // 時計SVGのHTMLテンプレート
    function createClockSVGHTML(id) {
        return `
        <div class="clock-container" data-clock-id="${id}">
            <svg class="clock-svg" data-id="${id}" viewBox="0 0 400 480" width="300" height="360">
                <text class="clock-title-text" data-id="${id}" x="200" y="35" text-anchor="middle" 
                      font-size="24" font-weight="bold" fill="#333"></text>
                
                <g transform="translate(0, 50)">
                    <circle cx="200" cy="200" r="180" fill="white" stroke="#333" stroke-width="3"/>
                    <g class="clock-marks" data-id="${id}"></g>
                    <g class="clock-numbers" data-id="${id}"></g>
                    <g class="clock-hands" data-id="${id}">
                        <line class="clock-hour-hand" data-id="${id}" x1="200" y1="200" x2="200" y2="100" 
                              stroke="#dc3545" stroke-width="8" stroke-linecap="round"/>
                        <line class="clock-minute-hand" data-id="${id}" x1="200" y1="200" x2="200" y2="60" 
                              stroke="#0d6efd" stroke-width="5" stroke-linecap="round"/>
                        <line class="clock-second-hand" data-id="${id}" x1="200" y1="200" x2="200" y2="50" 
                              stroke="#198754" stroke-width="2" stroke-linecap="round"/>
                    </g>
                    <circle cx="200" cy="200" r="8" fill="#333"/>
                </g>
                
                <text class="clock-digital-text" data-id="${id}" x="200" y="465" text-anchor="middle" 
                      font-size="28" font-family="monospace" font-weight="bold" fill="#333"
                      style="display: none;"></text>
            </svg>
        </div>
        `;
    }

    // 時計を追加
    function addClock() {
        const id = clockId++;
        clocks.push(id);
        
        // 設定パネルに追加
        document.getElementById('clockSettingsContainer').insertAdjacentHTML('beforeend', createClockSettingsHTML(id));
        
        // 表示エリアに追加
        document.getElementById('clocksPrintArea').insertAdjacentHTML('beforeend', createClockSVGHTML(id));
        
        // イベントリスナー設定
        setupClockEventListeners(id);
        
        // 初期描画
        drawClockMarks(id);
        drawClockNumbers(id);
        updateClockHands(id);
    }

    // 時計を削除
    function removeClock(id) {
        if (clocks.length <= 1) {
            alert('最低1つの時計が必要です');
            return;
        }
        
        const index = clocks.indexOf(id);
        if (index > -1) {
            clocks.splice(index, 1);
        }
        
        document.querySelector(`.clock-settings[data-clock-id="${id}"]`).remove();
        document.querySelector(`.clock-container[data-clock-id="${id}"]`).remove();
    }

    // イベントリスナー設定
    function setupClockEventListeners(id) {
        const settings = document.querySelector(`.clock-settings[data-clock-id="${id}"]`);
        
        settings.querySelector('.clock-title').addEventListener('input', () => updateClockTitle(id));
        settings.querySelector('.clock-hour').addEventListener('input', () => updateClockHands(id));
        settings.querySelector('.clock-minute').addEventListener('input', () => updateClockHands(id));
        settings.querySelector('.clock-second').addEventListener('input', () => updateClockHands(id));
        settings.querySelector('.clock-hour-color').addEventListener('input', () => updateClockColors(id));
        settings.querySelector('.clock-minute-color').addEventListener('input', () => updateClockColors(id));
        settings.querySelector('.clock-second-color').addEventListener('input', () => updateClockColors(id));
        settings.querySelector('.clock-show-second').addEventListener('change', () => updateClockSecondVisibility(id));
        settings.querySelector('.clock-show-numbers').addEventListener('change', () => drawClockNumbers(id));
        settings.querySelector('.clock-show-marks').addEventListener('change', () => drawClockMarks(id));
        settings.querySelector('.clock-show-digital').addEventListener('change', () => updateClockDigitalVisibility(id));
        settings.querySelector('.clock-use-24h').addEventListener('change', () => updateClockHands(id));
        settings.querySelector('.clock-now-btn').addEventListener('click', () => setClockNow(id));
        settings.querySelector('.clock-clear-btn').addEventListener('click', () => clearClockTime(id));
        settings.querySelector('.clock-clear-title-btn').addEventListener('click', () => clearClockTitle(id));
    }

    // 目盛りを描画
    function drawClockMarks(id) {
        const marksGroup = document.querySelector(`.clock-marks[data-id="${id}"]`);
        const showMarks = document.querySelector(`.clock-show-marks[data-id="${id}"]`).checked;
        marksGroup.innerHTML = '';
        
        const cx = 200, cy = 200, r = 165;
        
        for (let i = 0; i < 60; i++) {
            const angle = (i * 6 - 90) * Math.PI / 180;
            const isHour = i % 5 === 0;
            
            if (!showMarks && !isHour) continue;
            
            const innerR = isHour ? r - 18 : r - 8;
            const x1 = cx + innerR * Math.cos(angle);
            const y1 = cy + innerR * Math.sin(angle);
            const x2 = cx + r * Math.cos(angle);
            const y2 = cy + r * Math.sin(angle);
            
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', '#333');
            line.setAttribute('stroke-width', isHour ? 3 : 1.5);
            marksGroup.appendChild(line);
        }
    }

    // 数字を描画
    function drawClockNumbers(id) {
        const numbersGroup = document.querySelector(`.clock-numbers[data-id="${id}"]`);
        const showNumbers = document.querySelector(`.clock-show-numbers[data-id="${id}"]`).checked;
        numbersGroup.innerHTML = '';
        
        if (!showNumbers) return;
        
        const cx = 200, cy = 200, r = 125;
        
        for (let i = 1; i <= 12; i++) {
            const angle = (i * 30 - 90) * Math.PI / 180;
            const x = cx + r * Math.cos(angle);
            const y = cy + r * Math.sin(angle);
            
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', x);
            text.setAttribute('y', y);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('dominant-baseline', 'central');
            text.setAttribute('font-size', '24');
            text.setAttribute('font-weight', 'bold');
            text.setAttribute('fill', '#333');
            text.textContent = i;
            numbersGroup.appendChild(text);
        }
    }

    // 針の位置を更新
    function updateClockHands(id) {
        const settings = document.querySelector(`.clock-settings[data-clock-id="${id}"]`);
        let hour = parseInt(settings.querySelector('.clock-hour').value) || 0;
        let minute = parseInt(settings.querySelector('.clock-minute').value) || 0;
        let second = parseInt(settings.querySelector('.clock-second').value) || 0;
        const use24h = settings.querySelector('.clock-use-24h').checked;
        
        hour = Math.max(0, Math.min(28, hour));
        minute = Math.max(0, Math.min(59, minute));
        second = Math.max(0, Math.min(59, second));
        
        const hourAngle = (hour % 12 + minute / 60) * 30;
        const minuteAngle = (minute + second / 60) * 6;
        const secondAngle = second * 6;
        
        const cx = 200, cy = 200;
        const hourLength = 100;
        const minuteLength = 140;
        const secondLength = 150;
        
        const hourRad = (hourAngle - 90) * Math.PI / 180;
        const minuteRad = (minuteAngle - 90) * Math.PI / 180;
        const secondRad = (secondAngle - 90) * Math.PI / 180;
        
        const hourHand = document.querySelector(`.clock-hour-hand[data-id="${id}"]`);
        const minuteHand = document.querySelector(`.clock-minute-hand[data-id="${id}"]`);
        const secondHand = document.querySelector(`.clock-second-hand[data-id="${id}"]`);
        
        hourHand.setAttribute('x2', cx + hourLength * Math.cos(hourRad));
        hourHand.setAttribute('y2', cy + hourLength * Math.sin(hourRad));
        
        minuteHand.setAttribute('x2', cx + minuteLength * Math.cos(minuteRad));
        minuteHand.setAttribute('y2', cy + minuteLength * Math.sin(minuteRad));
        
        secondHand.setAttribute('x2', cx + secondLength * Math.cos(secondRad));
        secondHand.setAttribute('y2', cy + secondLength * Math.sin(secondRad));
        
        // デジタル時刻更新
        let displayHour = use24h ? hour : (hour % 12 || 12);
        const digitalText = document.querySelector(`.clock-digital-text[data-id="${id}"]`);
        digitalText.textContent = `${String(displayHour).padStart(2, '0')}:${String(minute).padStart(2, '0')}:${String(second).padStart(2, '0')}`;
    }

    // タイトル更新
    function updateClockTitle(id) {
        const title = document.querySelector(`.clock-title[data-id="${id}"]`).value;
        document.querySelector(`.clock-title-text[data-id="${id}"]`).textContent = title;
    }

    // 色更新
    function updateClockColors(id) {
        const settings = document.querySelector(`.clock-settings[data-clock-id="${id}"]`);
        const hourColor = settings.querySelector('.clock-hour-color').value;
        const minuteColor = settings.querySelector('.clock-minute-color').value;
        const secondColor = settings.querySelector('.clock-second-color').value;
        
        document.querySelector(`.clock-hour-hand[data-id="${id}"]`).setAttribute('stroke', hourColor);
        document.querySelector(`.clock-minute-hand[data-id="${id}"]`).setAttribute('stroke', minuteColor);
        document.querySelector(`.clock-second-hand[data-id="${id}"]`).setAttribute('stroke', secondColor);
    }

    // 秒針表示/非表示
    function updateClockSecondVisibility(id) {
        const show = document.querySelector(`.clock-show-second[data-id="${id}"]`).checked;
        document.querySelector(`.clock-second-hand[data-id="${id}"]`).style.display = show ? '' : 'none';
    }

    // デジタル表示/非表示
    function updateClockDigitalVisibility(id) {
        const show = document.querySelector(`.clock-show-digital[data-id="${id}"]`).checked;
        document.querySelector(`.clock-digital-text[data-id="${id}"]`).style.display = show ? '' : 'none';
    }

    // 現在時刻を設定
    function setClockNow(id) {
        const settings = document.querySelector(`.clock-settings[data-clock-id="${id}"]`);
        const now = new Date();
        settings.querySelector('.clock-hour').value = now.getHours();
        settings.querySelector('.clock-minute').value = now.getMinutes();
        settings.querySelector('.clock-second').value = now.getSeconds();
        updateClockHands(id);
    }

    // 時刻クリア
    function clearClockTime(id) {
        const settings = document.querySelector(`.clock-settings[data-clock-id="${id}"]`);
        settings.querySelector('.clock-hour').value = 0;
        settings.querySelector('.clock-minute').value = 0;
        settings.querySelector('.clock-second').value = 0;
        updateClockHands(id);
    }

    // タイトルクリア
    function clearClockTitle(id) {
        const settings = document.querySelector(`.clock-settings[data-clock-id="${id}"]`);
        settings.querySelector('.clock-title').value = '';
        updateClockTitle(id);
    }

    // レイアウト変更
    function updateLayout() {
        const isHorizontal = document.getElementById('layoutHorizontal').checked;
        const printArea = document.getElementById('clocksPrintArea');
        
        if (isHorizontal) {
            printArea.classList.add('horizontal');
        } else {
            printArea.classList.remove('horizontal');
        }
    }

    // 初期化
    document.getElementById('addClockBtn').addEventListener('click', addClock);
    document.getElementById('printBtn').addEventListener('click', () => window.print());
    document.getElementById('layoutVertical').addEventListener('change', updateLayout);
    document.getElementById('layoutHorizontal').addEventListener('change', updateLayout);

    // 初期時計を2つ追加
    addClock();
    addClock();
    
    // デフォルト値設定
    document.querySelector('.clock-title[data-id="0"]').value = '開始';
    document.querySelector('.clock-title[data-id="1"]').value = '終了';
    document.querySelector('.clock-hour[data-id="1"]').value = '11';
    updateClockTitle(0);
    updateClockTitle(1);
    updateClockHands(1);
</script>
</body>
</html>